
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Protocol &#8212; pyatv 0.4.0.dev0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Finding Devices" href="finding_devices.html" />
    <link rel="prev" title="pyatv: Apple TV Remote Control Library" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="protocol">
<span id="aiohttp-protocol"></span><h1>Protocol<a class="headerlink" href="#protocol" title="Permalink to this headline">¶</a></h1>
<p>The Apple TV uses the proprietary DAAP protocol, initially created by Apple for
sharing music with iTunes. It is built on top of the DMAP protocol, which uses
HTTP for transport on TCP port 3689. There are already a bunch of sites and
libraries describing and implementing these protocol, please see the reference
list below. This page will concentrate on the technical aspects used to
implement DAAP and DMAP in pyatv.</p>
<div class="section" id="daap-and-dmap">
<h2>DAAP and DMAP<a class="headerlink" href="#daap-and-dmap" title="Permalink to this headline">¶</a></h2>
<p>DMAP is basically a HTTP server that responds to specific commands and streams
events back to the client. Data is requested using GET and POST with special
URLs. Data in the responses is usually in a specic binary format, but depending on
the request it can also be something else (like a PNG file for artwork). The
binary protocol will be explained first, as that makes it easier to understand
the requests.</p>
<div class="section" id="dmap-binary-format">
<h3>DMAP Binary Format<a class="headerlink" href="#dmap-binary-format" title="Permalink to this headline">¶</a></h3>
<p>The binary format is basically TLV data where the tag is a 4 byte ASCII-string,
the length is a four byte unsigned integer and the data is, well, data. Type
and meaning of a specific TLV is derived from the tag. So we must know which
tags are used, how large they are and what they mean. Please note that Length
is length of the data, so key and length are not included in this size.</p>
<p>A TLV looks like this:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 34%" />
<col style="width: 38%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Key (4 bytes)</p></td>
<td><p>Length (4 bytes)</p></td>
<td><p>Data (Length bytes</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Multiple TLVs are usually embedded in one DMAP data stream and TLVs may also
be nested, to form a tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TLV1</span>
<span class="o">|</span>
<span class="o">+---</span><span class="n">TLV2</span>
<span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">+</span> <span class="n">TLV3</span>
<span class="o">|</span>
<span class="o">+---</span><span class="n">TLV4</span>
    <span class="o">|</span>
    <span class="o">+</span> <span class="n">TLV5</span>
</pre></div>
</div>
<p>As stated earlier, we must already know if a tag is a “container” (that
contains other TLVs) or not. It cannot easily be seen on the data itself.
A container usually has more resemblance to an array than a dictionary
since multiple TLVs with the same key often occurs.</p>
<p>All tags currently known by <code class="docutils literal notranslate"><span class="pre">pyatv</span></code> is defined in
<code class="xref py py-mod docutils literal notranslate"><span class="pre">pyatv.tag_definitions</span></code>.</p>
</div>
<div class="section" id="decoding-example">
<h3>Decoding Example<a class="headerlink" href="#decoding-example" title="Permalink to this headline">¶</a></h3>
<p>Lets assume that we know the following three keys:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 29%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cmst</p></td>
<td><p>Container</p></td>
<td><p>dmcp.playstatus</p></td>
</tr>
<tr class="row-odd"><td><p>mstt</p></td>
<td><p>uint32</p></td>
<td><p>dmap.status</p></td>
</tr>
<tr class="row-even"><td><p>cmsr</p></td>
<td><p>uint32</p></td>
<td><p>dmcp.serverrevision</p></td>
</tr>
</tbody>
</table>
<p>Now, let us try to decode the following binary data with the table above:</p>
<blockquote>
<div><p>636d7374000000186d73747400000004000000c8636d73720000000400000019</p>
</div></blockquote>
<p>We know that key and length fields are always four bytes, so lets split the
TLV so we more easily can see what is happening:</p>
<blockquote>
<div><p>636d7374 00000018 6d73747400000004000000c8636d73720000000400000019</p>
</div></blockquote>
<p>How nice,  0x636d7374 corresponds to <em>cmst</em> in ASCII and we happen to know
what that is. We can also see that the data is 0x18 = 24 bytes long which so
happens to be the remaining data. All the following TLVs are thus children
to <em>cmst</em> since that is a container. Lets continue and split the remaining
data:</p>
<blockquote>
<div><p>6d737474 00000004 000000c8636d73720000000400000019</p>
</div></blockquote>
<p>Again, we can see that the key 0x6d737474 is <em>mstt</em> in ASCII. This is a uint32
which means that the size is four bytes and the we should interpret the four
following bytes a uint32:</p>
<blockquote>
<div><p>000000c8 = 200</p>
</div></blockquote>
<p>Since we have data remaining, that should be another TLV and we have to
continue decoding that one as well. Same procedure:</p>
<blockquote>
<div><p>636d7372 00000004 00000019</p>
</div></blockquote>
<p>The tag is 0x636d7372 = <em>cmsr</em>, size is four bytes (uint32) and the decoded
value is 25. The final decoding looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+</span> <span class="n">cmst</span><span class="p">:</span>
  <span class="o">|</span>
  <span class="o">+-</span> <span class="n">mstt</span><span class="p">:</span> <span class="mi">200</span>
  <span class="o">|</span>
  <span class="o">+-</span> <span class="n">cmsr</span><span class="p">:</span> <span class="mi">25</span>
</pre></div>
</div>
<p>Note that <em>mstt</em> and <em>cmsr</em> are part of the <em>cmst</em> container. This is a typical
response that the Apple TV responds with when doing a “playstatusupdate” request
and nothing is currently playing. Other keys and values are included when
you for instance are playing video or music.</p>
</div>
<div class="section" id="request-urls">
<h3>Request URLs<a class="headerlink" href="#request-urls" title="Permalink to this headline">¶</a></h3>
<p>Since DAAP is sent over HTTP, requests can be made with any HTTP client. However,
some special headers must be included. These have been extracted with Wireshark
when using the Remote app on an iPhone and covers <code class="docutils literal notranslate"><span class="pre">GET</span></code>-requests:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Header</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Accept</p></td>
<td><p><em>/</em></p></td>
</tr>
<tr class="row-odd"><td><p>Accept-Encoding</p></td>
<td><p>gzip</p></td>
</tr>
<tr class="row-even"><td><p>Client-DAAP-Version</p></td>
<td><p>3.13</p></td>
</tr>
<tr class="row-odd"><td><p>Client-ATV-Sharing-Version</p></td>
<td><p>1.2</p></td>
</tr>
<tr class="row-even"><td><p>Client-iTunes-Sharing-Version</p></td>
<td><p>3.15</p></td>
</tr>
<tr class="row-odd"><td><p>User-Agent</p></td>
<td><p>Remote/1021</p></td>
</tr>
<tr class="row-even"><td><p>Viewer-Only-Client</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>For <code class="docutils literal notranslate"><span class="pre">POST</span></code>-request, the following header must be present as well:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Header</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Content-Type</p></td>
<td><p>application/x-www-form-urlencoded</p></td>
</tr>
</tbody>
</table>
<p>There are a lot of different requests that can be sent and this library
implements far from all of them. Fact is that there is support for things that
aren’t implemented by the native Remote app, like scrubbing (changing absolute
position in the stream). Since it’s the same commands as used by iTunes, we can
probably assume that it’s the same software implementation used in both
products. Enough on that matter… All the requests that are used by this
library is described in its own chapter a bit further down.</p>
</div>
<div class="section" id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h3>
<p>Some commands can be queried freely by anyone on the same network as the Apple TV,
like the server-info command. But most commands require a “session id”. The
session id is obtained by doing login and extracting the <code class="docutils literal notranslate"><span class="pre">mlid</span></code> key. Session id
is then included in all requests, e.g.</p>
<blockquote>
<div><p>ctrl-int/1/playstatusupdate?session-id=&lt;session id&gt;&amp;revision-number=0</p>
</div></blockquote>
<p>The device will respond with an error (503?) if the authentication fails.</p>
</div>
</div>
<div class="section" id="supported-requests">
<h2>Supported Requests<a class="headerlink" href="#supported-requests" title="Permalink to this headline">¶</a></h2>
<p>This list is only covers the requests performed by <code class="docutils literal notranslate"><span class="pre">pyatv</span></code> and is thus not
complete.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This chapter is far from complete. Only an outline is included here.
Better examples and descriptions will be added when needed.</p>
</div>
<div class="section" id="server-info">
<h3>server-info<a class="headerlink" href="#server-info" title="Permalink to this headline">¶</a></h3>
<p><strong>Type:</strong> GET</p>
<p><strong>URL:</strong> server-info</p>
<p><strong>Authentication:</strong> None</p>
<p>Returns various information about a device. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msrv</span><span class="p">:</span> <span class="p">[</span><span class="n">container</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">serverinforesponse</span><span class="p">]</span>
  <span class="n">mstt</span><span class="p">:</span> <span class="mi">200</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">status</span><span class="p">]</span>
  <span class="n">mpro</span><span class="p">:</span> <span class="mi">131082</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">protocolversion</span><span class="p">]</span>
  <span class="n">minm</span><span class="p">:</span> <span class="n">Apple</span> <span class="n">TV</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">itemname</span><span class="p">]</span>
  <span class="n">apro</span><span class="p">:</span> <span class="mi">196620</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">daap</span><span class="o">.</span><span class="n">protocolversion</span><span class="p">]</span>
  <span class="n">aeSV</span><span class="p">:</span> <span class="mi">196618</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">com</span><span class="o">.</span><span class="n">apple</span><span class="o">.</span><span class="n">itunes</span><span class="o">.</span><span class="n">music</span><span class="o">-</span><span class="n">sharing</span><span class="o">-</span><span class="n">version</span><span class="p">]</span>
  <span class="n">mstm</span><span class="p">:</span> <span class="mi">1800</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">timeoutinterval</span><span class="p">]</span>
  <span class="n">msdc</span><span class="p">:</span> <span class="mi">1</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">databasescount</span><span class="p">]</span>
  <span class="n">aeFP</span><span class="p">:</span> <span class="mi">2</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">com</span><span class="o">.</span><span class="n">apple</span><span class="o">.</span><span class="n">itunes</span><span class="o">.</span><span class="n">req</span><span class="o">-</span><span class="n">fplay</span><span class="p">]</span>
  <span class="n">aeFR</span><span class="p">:</span> <span class="mi">100</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">mslr</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">loginrequired</span><span class="p">]</span>
  <span class="n">msal</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportsautologout</span><span class="p">]</span>
  <span class="n">mstc</span><span class="p">:</span> <span class="mi">1485803565</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">utctime</span><span class="p">]</span>
  <span class="n">msto</span><span class="p">:</span> <span class="mi">3600</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">]</span>
  <span class="n">atSV</span><span class="p">:</span> <span class="mi">65541</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">ated</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">daap</span><span class="o">.</span><span class="n">supportsextradata</span><span class="p">]</span>
  <span class="n">asgr</span><span class="p">:</span> <span class="mi">3</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">com</span><span class="o">.</span><span class="n">apple</span><span class="o">.</span><span class="n">itunes</span><span class="o">.</span><span class="n">gapless</span><span class="o">-</span><span class="n">resy</span><span class="p">]</span>
  <span class="n">asse</span><span class="p">:</span> <span class="mi">7341056</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">aeSX</span><span class="p">:</span> <span class="mi">3</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">msed</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportsedit</span><span class="p">]</span>
  <span class="n">msup</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportsupdate</span><span class="p">]</span>
  <span class="n">mspi</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportspersistentids</span><span class="p">]</span>
  <span class="n">msex</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportsextensions</span><span class="p">]</span>
  <span class="n">msbr</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportsbrowse</span><span class="p">]</span>
  <span class="n">msqy</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportsquery</span><span class="p">]</span>
  <span class="n">msix</span><span class="p">:</span> <span class="kc">True</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">supportsindex</span><span class="p">]</span>
  <span class="n">mscu</span><span class="p">:</span> <span class="mi">101</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="login">
<h3>login<a class="headerlink" href="#login" title="Permalink to this headline">¶</a></h3>
<p><strong>Type:</strong> GET</p>
<p><strong>URL:</strong> login?hsgid=&lt;hsgid&gt;&amp;hasFP=1</p>
<p><strong>URL:</strong> login?pairing-guid=&lt;PAIRING GUID&gt;&amp;hasFP=1</p>
<p><strong>Authentication:</strong> HSGID or PAIRING GUID</p>
<p>Used to login and get a <code class="docutils literal notranslate"><span class="pre">session</span> <span class="pre">id</span></code>, that is needed for most commands.
Example response from device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mlog</span><span class="p">:</span> <span class="p">[</span><span class="n">container</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">loginresponse</span><span class="p">]</span>
  <span class="n">mstt</span><span class="p">:</span> <span class="mi">200</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">status</span><span class="p">]</span>
  <span class="n">mlid</span><span class="p">:</span> <span class="mi">1739004399</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">sessionid</span><span class="p">]</span>
</pre></div>
</div>
<p>Expected format for HSGID and PAIRING GUID respectively:</p>
<ul class="simple">
<li><p>HSGID: <code class="docutils literal notranslate"><span class="pre">XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</span></code></p></li>
<li><p>PAIRING GUID: <code class="docutils literal notranslate"><span class="pre">0xXXXXXXXXXXXXXXXX</span></code></p></li>
</ul>
<p>Where <code class="docutils literal notranslate"><span class="pre">X</span></code> corresponds to a hex digit (0-F).</p>
</div>
<div class="section" id="playstatusupdate">
<h3>playstatusupdate<a class="headerlink" href="#playstatusupdate" title="Permalink to this headline">¶</a></h3>
<p><strong>Type:</strong> GET</p>
<p><strong>URL:</strong> ctrl-int/1/playstatusupdate?session-id=&lt;session id&gt;&amp;revision-number=&lt;revision number&gt;</p>
<p><strong>Authentication:</strong> Session ID</p>
<p>The response contains information about what is currently playing. Example
response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmst</span><span class="p">:</span> <span class="p">[</span><span class="n">container</span><span class="p">,</span> <span class="n">dmcp</span><span class="o">.</span><span class="n">playstatus</span><span class="p">]</span>
  <span class="n">mstt</span><span class="p">:</span> <span class="mi">200</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmap</span><span class="o">.</span><span class="n">status</span><span class="p">]</span>
  <span class="n">cmsr</span><span class="p">:</span> <span class="mi">159</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dmcp</span><span class="o">.</span><span class="n">serverrevision</span><span class="p">]</span>
  <span class="n">caps</span><span class="p">:</span> <span class="mi">4</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">playstatus</span><span class="p">]</span>
  <span class="n">cash</span><span class="p">:</span> <span class="mi">0</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">shufflestate</span><span class="p">]</span>
  <span class="n">carp</span><span class="p">:</span> <span class="mi">0</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">repeatstate</span><span class="p">]</span>
  <span class="n">cafs</span><span class="p">:</span> <span class="mi">0</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">fullscreen</span><span class="p">]</span>
  <span class="n">cavs</span><span class="p">:</span> <span class="mi">0</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">visualizer</span><span class="p">]</span>
  <span class="n">cavc</span><span class="p">:</span> <span class="kc">False</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">volumecontrollable</span><span class="p">]</span>
  <span class="n">caas</span><span class="p">:</span> <span class="mi">1</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">albumshuffle</span><span class="p">]</span>
  <span class="n">caar</span><span class="p">:</span> <span class="mi">1</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">albumrepeat</span><span class="p">]</span>
  <span class="n">cafe</span><span class="p">:</span> <span class="kc">False</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">fullscreenenabled</span><span class="p">]</span>
  <span class="n">cave</span><span class="p">:</span> <span class="kc">False</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">dacpvisualizerenabled</span><span class="p">]</span>
  <span class="n">ceQA</span><span class="p">:</span> <span class="mi">0</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">cann</span><span class="p">:</span> <span class="n">Call</span> <span class="n">On</span> <span class="n">Me</span> <span class="o">-</span> <span class="n">Ryan</span> <span class="n">Riback</span> <span class="n">Remix</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">daap</span><span class="o">.</span><span class="n">nowplayingtrack</span><span class="p">]</span>
  <span class="n">cana</span><span class="p">:</span> <span class="n">Starley</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">daap</span><span class="o">.</span><span class="n">nowplayingartist</span><span class="p">]</span>
  <span class="n">canl</span><span class="p">:</span> <span class="n">Call</span> <span class="n">On</span> <span class="n">Me</span> <span class="p">(</span><span class="n">Remixes</span><span class="p">)</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">daap</span><span class="o">.</span><span class="n">nowplayingalbum</span><span class="p">]</span>
  <span class="n">ceSD</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;...&#39;</span> <span class="p">[</span><span class="n">raw</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">casc</span><span class="p">:</span> <span class="mi">1</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">caks</span><span class="p">:</span> <span class="mi">6</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">unknown</span> <span class="n">tag</span><span class="p">]</span>
  <span class="n">cant</span><span class="p">:</span> <span class="mi">214005</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">remainingtime</span><span class="p">]</span>
  <span class="n">cast</span><span class="p">:</span> <span class="mi">222000</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">tracklength</span><span class="p">]</span>
  <span class="n">casu</span><span class="p">:</span> <span class="mi">0</span> <span class="p">[</span><span class="n">uint</span><span class="p">,</span> <span class="n">dacp</span><span class="o">.</span><span class="n">su</span><span class="p">]</span>
</pre></div>
</div>
<p>The field <code class="docutils literal notranslate"><span class="pre">cmsr</span></code> (dmcp.serverrevision) is used to realize “push updates”.
By setting <code class="docutils literal notranslate"><span class="pre">&lt;revision</span> <span class="pre">number&gt;</span></code> to this number, the GET-request will block
until something happens on the device. This number will increase for each
update, so the next time it will be 160, 161, and so on. Using revision
number 0 will never block and can be used to poll current playstatus.</p>
</div>
<div class="section" id="nowplayingartwork">
<h3>nowplayingartwork<a class="headerlink" href="#nowplayingartwork" title="Permalink to this headline">¶</a></h3>
<p><strong>Type:</strong> GET</p>
<p><strong>URL:</strong> ctrl-int/1/nowplayingartwork?mw=1024&amp;mh=576&amp;session-id=&lt;session id&gt;</p>
<p><strong>Authentication:</strong> Session ID</p>
<p>Returns a PNG image for what is currently playing, like a poster or album art.
If not present, an empty response is returned. Width and height of image can be
altered with <code class="docutils literal notranslate"><span class="pre">mw</span></code> and <code class="docutils literal notranslate"><span class="pre">mh</span></code>, but will be ignored if available image is smaller
then the requested size.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This request is relatively expensive to perform, so perform it as seldom as
possible.</p>
</div>
</div>
<div class="section" id="ctrl-int">
<h3>ctrl-int<a class="headerlink" href="#ctrl-int" title="Permalink to this headline">¶</a></h3>
<p><strong>Type:</strong> POST</p>
<p><strong>URL:</strong> ctrl-int/1/&lt;command&gt;?session-id=&lt;session id&gt;&amp;prompt-id=0</p>
<p><strong>Authentication:</strong> Session ID</p>
<p>&lt;command&gt; corresponds to the command to execute. Can be any of <code class="docutils literal notranslate"><span class="pre">play</span></code>, <code class="docutils literal notranslate"><span class="pre">pause</span></code>,
<code class="docutils literal notranslate"><span class="pre">nextitem</span></code> or <code class="docutils literal notranslate"><span class="pre">previtem</span></code>.</p>
</div>
<div class="section" id="controlpromptentry">
<h3>controlpromptentry<a class="headerlink" href="#controlpromptentry" title="Permalink to this headline">¶</a></h3>
<p><strong>Type:</strong> POST</p>
<p><strong>URL:</strong> ctrl-int/1/controlpromptentry?session-id=&lt;session id&gt;&amp;prompt-id=0</p>
<p><strong>Authentication:</strong> Session ID</p>
<p>Used to trigger various buttons, like menu or select. Must contain the
following binary DMAP data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cmbe</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">string</span><span class="p">]</span>
<span class="n">cmcc</span><span class="p">:</span> <span class="mi">0</span> <span class="p">[</span><span class="n">string</span><span class="p">]</span>
</pre></div>
</div>
<p>No external container is used. &lt;command&gt; can be either <code class="docutils literal notranslate"><span class="pre">select</span></code>, <code class="docutils literal notranslate"><span class="pre">menu</span></code> or
<code class="docutils literal notranslate"><span class="pre">topmenu</span></code>.</p>
</div>
<div class="section" id="setproperty">
<h3>setproperty<a class="headerlink" href="#setproperty" title="Permalink to this headline">¶</a></h3>
<p><strong>Type:</strong> POST:</p>
<p><strong>URL:</strong> ctrl-int/1/setproperty?&lt;key&gt;=&lt;value&gt;&amp;session-id=&lt;session id&gt;&amp;prompt-id=0</p>
<p><strong>Authentication:</strong> Session ID</p>
<p>Changes a property for something.</p>
<p>Summary of supported properties:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 9%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dacp.playingtime</p></td>
<td><p>uint</p></td>
<td><p>Time in seconds</p></td>
</tr>
<tr class="row-odd"><td><p>dacp.shufflestate</p></td>
<td><p>bool</p></td>
<td><p>Shuffle state on/off</p></td>
</tr>
<tr class="row-even"><td><p>dacp.repeatstate</p></td>
<td><p>uint</p></td>
<td><p>Repeat mode (0=Off, 1=Track, 2=All)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="Https://en.wikipedia.org/wiki/Digital_Media_Access_Protocol">Https://en.wikipedia.org/wiki/Digital_Media_Access_Protocol</a></p>
<p><a class="reference external" href="https://github.com/benumc/Apple-TV-Basic-IP/blob/master/apple_apple%20tv%20(ip).xml">https://github.com/benumc/Apple-TV-Basic-IP/blob/master/apple_apple%20tv%20(ip).xml</a></p>
<p><a class="reference external" href="https://nto.github.io/AirPlay.html">https://nto.github.io/AirPlay.html</a></p>
<p><a class="reference external" href="http://stackoverflow.com/questions/35355807/has-anyone-reversed-engineered-the-protocol-used-by-apples-ios-remote-app-for-c">http://stackoverflow.com/questions/35355807/has-anyone-reversed-engineered-the-protocol-used-by-apples-ios-remote-app-for-c</a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pyatv</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Protocol</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#daap-and-dmap">DAAP and DMAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-requests">Supported Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="finding_devices.html">Finding Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairing.html">Pairing with a device</a></li>
<li class="toctree-l1"><a class="reference internal" href="connecting.html">Connecting</a></li>
<li class="toctree-l1"><a class="reference internal" href="controlling.html">Controlling a device</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Retrieving metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="airplay.html">AirPlay Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="atvremote.html">Reference application: atvremote</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing.html">Developing pyatv</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">pyatv: Apple TV Remote Control Library</a></li>
      <li>Next: <a href="finding_devices.html" title="next chapter">Finding Devices</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Pierre Ståhl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/protocol.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>